# Low-level tests for the CXXR classes.

uname = $(shell uname)

top_builddir = ../..

top_srcdir = ../..

R = $(top_builddir)/bin/R --vanilla --quiet
RDIFF = $(top_builddir)/bin/R CMD Rdiff
REXEC= $(top_builddir)/bin/exec/R

include $(top_builddir)/Makeconf

tests = miscR xml_s11n xml_s11n_2

check : $(tests:=.ts)

miscR.ts : $(REXEC) misc.R misc.save
	$(R) < misc.R > misc.Rout 2>&1
	diff misc.save misc.Rout
	rm misc.Rout
	touch $@

xml_s11n.ts : $(REXEC) xml_serialize.R xml_deserialize.R xml_s11n.save
	rm -f bserialize.xml
	$(R) < xml_serialize.R
	$(R) < xml_deserialize.R > xml_s11n.fail
	$(RDIFF) xml_s11n.save xml_s11n.fail 1
	rm -f bserialize.xml xml_s11n.fail
	touch $@

xml_s11n_2.ts : $(REXEC) xml_serialize_2.R xml_deserialize_2.R
	rm -f bserialize.xml
	$(R) < xml_serialize_2.R > /dev/null 2>&1
	$(R) < xml_deserialize_2.R
	diff xml_serialize_2.pre xml_serialize_2.post
	rm -f xml_serialize_2.pre xml_serialize_2.post reg-tests-2.pdf
	touch $@

Makefile : Makefile.in
	cp $< $@

clean:
	rm -f *.ts

distclean: clean
	rm -f Makefile

include $(depends)
